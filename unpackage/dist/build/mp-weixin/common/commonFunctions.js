"use strict";var e=require("./vendor.js");const r=e.rn.importObject("wxCloudFunctions",{customUI:!0}),t=e.rn.database(),n=getApp();var o={wxLogin:async()=>{let o=-1,a="",c={};try{await e.index.login({provider:"weixin"}).then((async e=>{const t=await r.login(e.code);o=t.errCode,a=t.errMsg,c=t.data})).catch((e=>{a=e})),0!==o?e.index.showModal({title:"登录失败",content:a,showCancel:!1}):await t.collection("user").where("wx_openid == '"+c.openid+"'").get().then((async r=>{0===r.result.errCode&&(0===r.result.data.length?await t.collection("user").add({wx_openid:c.openid,role:"ordinary",avatar:"",nickname:""}).then((r=>{e.index.setStorageSync("wx_openid",c.openid),n.globalData.wx_openid=c.openid})).catch():(e.index.setStorageSync("wx_openid",c.openid),n.globalData.wx_openid=c.openid))})).catch()}catch(i){}},checkContentSecurity:async e=>{try{const t=await r.getAccessToken();if(0!==t.errCode)return{errCode:-1,errMsg:"Token获取失败"};const o=await r.msgSecCheck(t.data.access_token,n.globalData.wx_openid,e);return 0!==o.errCode?{errCode:-1,errMsg:"内容合规检测失败"}:"pass"!==o.data.result.suggest?{errCode:-1,errMsg:"内容存在违规信息"}:{errCode:0,errMsg:"检测完成"}}catch(t){return{errCode:-1,errMsg:"内容合规检测失败"}}}};exports.commonFunctions=o;
