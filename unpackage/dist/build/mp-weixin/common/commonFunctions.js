"use strict";var e=require("./vendor.js");const t=e.pn.importObject("wxCloudFunctions",{customUI:!0}),r=e.pn.database(),n=getApp();var o={wxLogin:async()=>{let o=-1,a="",c={};try{await e.index.login({provider:"weixin"}).then((async e=>{const r=await t.login(e.code);o=r.errCode,a=r.errMsg,c=r.data})).catch((e=>{a=e})),0!==o?e.index.showModal({title:"登录失败",content:a,showCancel:!1}):await r.collection("user").where("wx_openid == '"+c.openid+"'").get().then((async t=>{0===t.result.errCode&&(0===t.result.data.length?await r.collection("user").add({wx_openid:c.openid,role:"ordinary",avatar:"",nickname:""}).then((t=>{e.index.setStorageSync("wx_openid",c.openid),n.globalData.wx_openid=c.openid})).catch():(e.index.setStorageSync("wx_openid",c.openid),n.globalData.wx_openid=c.openid))})).catch()}catch(i){}},checkContentSecurity:async e=>{try{const r=await t.getAccessToken();if(0!==r.errCode)return{errCode:-1,errMsg:"Token获取失败"};const o=await t.msgSecCheck(r.data.access_token,n.globalData.wx_openid,e);return 0!==o.errCode?{errCode:-1,errMsg:"内容合规检测失败"}:"pass"!==o.data.result.suggest?{errCode:-1,errMsg:"内容存在违规信息"}:{errCode:0,errMsg:"检测完成"}}catch(r){return{errCode:-1,errMsg:"内容合规检测失败"}}}};exports.commonFunctions=o;
